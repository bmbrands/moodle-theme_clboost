{"version":3,"sources":["../src/tsdrawer.js"],"names":["define","$","CustomEvents","Log","PubSub","SELECTORS","TOGGLE_REGION","TOGGLE_ACTION","TOGGLE_TARGET","TOGGLE_SIDE","BODY","SECTION","DRAWER","small","document","width","Drawer","length","debug","each","index","ele","trigger","find","drawerid","attr","drawer","getElementById","hidden","side","body","preference","M","util","set_user_preference","on","preventPageScroll","addClass","bind","registerEventListeners","closeAll","prototype","removeClass","toggleDrawer","e","target","closest","open","fullyexpanded","hasClass","focus","publish","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","element","events","activate","data","click"],"mappings":"AA0BAA,OAAM,0BAAC,CAAC,QAAD,CAAW,gCAAX,CAA6C,UAA7C,CAAyD,aAAzD,CAAD,CACF,SAAUC,CAAV,CAAaC,CAAb,CAA2BC,CAA3B,CAAgCC,CAAhC,CAAwC,IAEhCC,CAAAA,CAAS,CAAG,CACZC,aAAa,CAAE,iCADH,CAEZC,aAAa,CAAE,iCAFH,CAGZC,aAAa,CAAE,eAHH,CAIZC,WAAW,CAAE,MAJD,CAKZC,IAAI,CAAE,MALM,CAMZC,OAAO,CAAE,uCANG,CAOZC,MAAM,CAAE,aAPI,CAFoB,CAYhCC,CAAK,CAAyB,GAAtB,CAAAZ,CAAC,CAACa,QAAD,CAAD,CAAYC,KAAZ,EAZwB,CAmBhCC,CAAM,CAAG,UAAY,CAErB,GAAI,CAACf,CAAC,CAACI,CAAS,CAACC,aAAX,CAAD,CAA2BW,MAAhC,CAAwC,CACpCd,CAAG,CAACe,KAAJ,CAAU,iCAAV,CACH,CACD,GAAI,CAACjB,CAAC,CAACI,CAAS,CAACE,aAAX,CAAD,CAA2BU,MAAhC,CAAwC,CACpCd,CAAG,CAACe,KAAJ,CAAU,sCAAV,CACH,CACDjB,CAAC,CAACI,CAAS,CAACC,aAAX,CAAD,CAA2Ba,IAA3B,CAAgC,SAAUC,CAAV,CAAiBC,CAAjB,CAAsB,IAC9CC,CAAAA,CAAO,CAAGrB,CAAC,CAACoB,CAAD,CAAD,CAAOE,IAAP,CAAYlB,CAAS,CAACE,aAAtB,CADoC,CAE9CiB,CAAQ,CAAGF,CAAO,CAACG,IAAR,CAAa,eAAb,CAFmC,CAG9CC,CAAM,CAAGzB,CAAC,CAACa,QAAQ,CAACa,cAAT,CAAwBH,CAAxB,CAAD,CAHoC,CAI9CI,CAAM,CAAoC,OAAjC,EAAAN,CAAO,CAACG,IAAR,CAAa,eAAb,CAJqC,CAK9CI,CAAI,CAAGP,CAAO,CAACG,IAAR,CAAa,WAAb,CALuC,CAM9CK,CAAI,CAAG7B,CAAC,CAACI,CAAS,CAACK,IAAX,CANsC,CAO9CqB,CAAU,CAAGT,CAAO,CAACG,IAAR,CAAa,iBAAb,CAPiC,CAQlD,GAAIZ,CAAJ,CAAW,CACPmB,CAAC,CAACC,IAAF,CAAOC,mBAAP,CAA2BH,CAA3B,CAAuC,OAAvC,CACH,CAEDL,CAAM,CAACS,EAAP,CAAU,2BAAV,CAAuC,KAAKC,iBAA5C,EAEA,GAAI,CAACR,CAAL,CAAa,CACTE,CAAI,CAACO,QAAL,CAAc,eAAiBR,CAA/B,EACAP,CAAO,CAACG,IAAR,CAAa,eAAb,CAA8B,MAA9B,CACH,CAHD,IAGO,CACHH,CAAO,CAACG,IAAR,CAAa,eAAb,CAA8B,OAA9B,CACH,CACJ,CApB+B,CAoB9Ba,IApB8B,CAoBzB,IApByB,CAAhC,EAsBA,KAAKC,sBAAL,GACA,GAAI1B,CAAJ,CAAW,CACP,KAAK2B,QAAL,EACH,CACDvC,CAAC,CAACI,CAAS,CAACO,MAAV,CAAmB,uBAApB,CAAD,CAA8CuB,EAA9C,CAAiD,OAAjD,CAAyD,UAAU,CAC/DlC,CAAC,CAACI,CAAS,CAACE,aAAX,CAAD,CAA2Be,OAA3B,CAAmC,OAAnC,CACH,CAFD,CAIH,CAzDmC,CA2DpCN,CAAM,CAACyB,SAAP,CAAiBD,QAAjB,CAA4B,UAAY,CACpCvC,CAAC,CAACI,CAAS,CAACC,aAAX,CAAD,CAA2Ba,IAA3B,CAAgC,SAAUC,CAAV,CAAiBC,CAAjB,CAAsB,IAC9CC,CAAAA,CAAO,CAAGrB,CAAC,CAACoB,CAAD,CAAD,CAAOE,IAAP,CAAYlB,CAAS,CAACE,aAAtB,CADoC,CAE9CsB,CAAI,CAAGP,CAAO,CAACG,IAAR,CAAa,WAAb,CAFuC,CAG9CK,CAAI,CAAG7B,CAAC,CAACI,CAAS,CAACK,IAAX,CAHsC,CAI9Cc,CAAQ,CAAGF,CAAO,CAACG,IAAR,CAAa,eAAb,CAJmC,CAK9CC,CAAM,CAAGzB,CAAC,CAACa,QAAQ,CAACa,cAAT,CAAwBH,CAAxB,CAAD,CALoC,CAM9CO,CAAU,CAAGT,CAAO,CAACG,IAAR,CAAa,iBAAb,CANiC,CAQlDH,CAAO,CAACG,IAAR,CAAa,eAAb,CAA8B,OAA9B,EACAK,CAAI,CAACY,WAAL,CAAiB,eAAiBb,CAAlC,EACAH,CAAM,CAACD,IAAP,CAAY,aAAZ,CAA2B,MAA3B,EACAC,CAAM,CAACW,QAAP,CAAgB,QAAhB,EACA,GAAI,CAACxB,CAAL,CAAY,CACRmB,CAAC,CAACC,IAAF,CAAOC,mBAAP,CAA2BH,CAA3B,CAAuC,OAAvC,CACH,CACJ,CAfD,CAgBH,CAjBD,CAyBAf,CAAM,CAACyB,SAAP,CAAiBE,YAAjB,CAAgC,SAAUC,CAAV,CAAa,IACrCtB,CAAAA,CAAO,CAAGrB,CAAC,CAAC2C,CAAC,CAACC,MAAH,CAAD,CAAYC,OAAZ,CAAoB,6BAApB,CAD2B,CAErCtB,CAAQ,CAAGF,CAAO,CAACG,IAAR,CAAa,eAAb,CAF0B,CAGrCC,CAAM,CAAGzB,CAAC,CAACa,QAAQ,CAACa,cAAT,CAAwBH,CAAxB,CAAD,CAH2B,CAIrCM,CAAI,CAAG7B,CAAC,CAACI,CAAS,CAACK,IAAX,CAJ6B,CAKrCmB,CAAI,CAAGP,CAAO,CAACG,IAAR,CAAa,WAAb,CAL8B,CAMrCM,CAAU,CAAGT,CAAO,CAACG,IAAR,CAAa,iBAAb,CANwB,CAOzC,GAAIZ,CAAJ,CAAW,CACPmB,CAAC,CAACC,IAAF,CAAOC,mBAAP,CAA2BH,CAA3B,CAAuC,OAAvC,CACH,CAEDD,CAAI,CAACO,QAAL,CAAc,aAAd,EAXyC,GAarCU,CAAAA,CAAI,CAAoC,MAAjC,EAAAzB,CAAO,CAACG,IAAR,CAAa,eAAb,CAb8B,CAcrCuB,CAAa,CAAGtB,CAAM,CAACuB,QAAP,CAAgB,gBAAhB,CAdqB,CAgBzC,GAAI,CAACF,CAAL,CAAW,CAEPzB,CAAO,CAACG,IAAR,CAAa,eAAb,CAA8B,MAA9B,EACAC,CAAM,CAACD,IAAP,CAAY,aAAZ,CAA2B,OAA3B,EACAC,CAAM,CAACwB,KAAP,GACApB,CAAI,CAACO,QAAL,CAAc,eAAiBR,CAA/B,EACAH,CAAM,CAACgB,WAAP,CAAmB,QAAnB,EACA,GAAI,CAAC7B,CAAL,CAAY,CACRmB,CAAC,CAACC,IAAF,CAAOC,mBAAP,CAA2BH,CAA3B,CAAuC,MAAvC,CACH,CACJ,CAVD,IAUO,CACH,GAAIiB,CAAJ,CAAmB,CAEftB,CAAM,CAACgB,WAAP,CAAmB,gBAAnB,EACAZ,CAAI,CAACY,WAAL,CAAiB,eAAiBb,CAAlC,EACAC,CAAI,CAACY,WAAL,CAAiB,uBAAjB,EACApB,CAAO,CAACG,IAAR,CAAa,eAAb,CAA8B,OAA9B,EACAC,CAAM,CAACD,IAAP,CAAY,aAAZ,CAA2B,MAA3B,EACAC,CAAM,CAACW,QAAP,CAAgB,QAAhB,EACA,GAAI,CAACxB,CAAL,CAAY,CACRmB,CAAC,CAACC,IAAF,CAAOC,mBAAP,CAA2BH,CAA3B,CAAuC,OAAvC,CACH,CACJ,CAXD,IAWO,CACHL,CAAM,CAACW,QAAP,CAAgB,gBAAhB,EACAP,CAAI,CAACO,QAAL,CAAc,uBAAd,CACH,CACJ,CAKDjC,CAAM,CAAC+C,OAAP,CAAe,yBAAf,CAA0CJ,CAA1C,CACH,CAhDD,CAwDA/B,CAAM,CAACyB,SAAP,CAAiBL,iBAAjB,CAAqC,SAAUQ,CAAV,CAAa,CAC9C,GAAIQ,CAAAA,CAAK,CAAGR,CAAC,CAACS,UAAF,EAAiBT,CAAC,CAACU,aAAF,EAAmBV,CAAC,CAACU,aAAF,CAAgBD,UAApD,EAAmE,CAACT,CAAC,CAACU,aAAF,CAAgBC,MAAhG,CACIC,CAAc,CAAmE,CAAhE,EAAC,KAAKC,SAAL,CAAiBxD,CAAC,CAAC,IAAD,CAAD,CAAQyD,WAAR,EAAjB,CAAyC,KAAKC,YADpE,CAEIC,CAAW,CAAqB,CAAlB,OAAKH,SAFvB,CAIA,GAAa,CAAR,CAAAL,CAAK,EAAQI,CAAd,EAA0C,CAAR,CAAAJ,CAAK,EAAQQ,CAAnD,CAAiE,CAC7DhB,CAAC,CAACiB,cAAF,EACH,CACJ,CARD,CAeA7C,CAAM,CAACyB,SAAP,CAAiBF,sBAAjB,CAA0C,UAAY,CAElDtC,CAAC,CAACI,CAAS,CAACE,aAAX,CAAD,CAA2BY,IAA3B,CAAgC,SAAUC,CAAV,CAAiB0C,CAAjB,CAA0B,CACtD5D,CAAY,CAACF,MAAb,CAAoBC,CAAC,CAAC6D,CAAD,CAArB,CAAgC,CAAC5D,CAAY,CAAC6D,MAAb,CAAoBC,QAArB,CAAhC,EACA/D,CAAC,CAAC6D,CAAD,CAAD,CAAW3B,EAAX,CAAcjC,CAAY,CAAC6D,MAAb,CAAoBC,QAAlC,CAA4C,SAAUpB,CAAV,CAAaqB,CAAb,CAAmB,CAC3D,KAAKtB,YAAL,CAAkBsB,CAAI,CAACX,aAAvB,EACAW,CAAI,CAACX,aAAL,CAAmBO,cAAnB,EACH,CAH2C,CAG1CvB,IAH0C,CAGrC,IAHqC,CAA5C,CAIH,CAN+B,CAM9BA,IAN8B,CAMzB,IANyB,CAAhC,EAQArC,CAAC,CAACI,CAAS,CAACM,OAAX,CAAD,CAAqBuD,KAArB,CAA2B,UAAY,CACnC,GAAIrD,CAAJ,CAAW,CACP,KAAK2B,QAAL,EACH,CACJ,CAJ0B,CAIzBF,IAJyB,CAIpB,IAJoB,CAA3B,EAQArC,CAAC,CAACI,CAAS,CAACO,MAAX,CAAD,CAAoBuB,EAApB,CAAuB,mDAAvB,CAA4E,SAAUS,CAAV,CAAa,IACjFlB,CAAAA,CAAM,CAAGzB,CAAC,CAAC2C,CAAC,CAACC,MAAH,CAAD,CAAYC,OAAZ,CAAoBzC,CAAS,CAACO,MAA9B,CADwE,CAEjFmC,CAAI,CAAiC,OAA9B,EAAArB,CAAM,CAACD,IAAP,CAAY,aAAZ,CAF0E,CAGrFrB,CAAM,CAAC+C,OAAP,CAAe,uBAAf,CAAwCJ,CAAxC,CACH,CAJD,CAKH,CAvBD,CAyBA,MAAO,CACH,KAAQ,eAAY,CAChB,MAAO,IAAI/B,CAAAA,CACd,CAHE,CAKV,CA1LC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for a drawer.\n *\n * This is very similar to the boost routine (drawer.js), except that we have two states:\n * - Partially open with just icons showing up\n * - Fully opened\n *\n * @package   theme_clboost\n * @copyright 2020 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/custom_interaction_events', 'core/log', 'core/pubsub'],\n    function ($, CustomEvents, Log, PubSub) {\n\n        var SELECTORS = {\n            TOGGLE_REGION: '[data-region=\"drawer-toggle\"]',\n            TOGGLE_ACTION: '[data-action=\"toggle-drawer\"]',\n            TOGGLE_TARGET: 'aria-controls',\n            TOGGLE_SIDE: 'left',\n            BODY: 'body',\n            SECTION: '.list-group-item[href*=\"#section-\"]',\n            DRAWER: '#nav-drawer'\n        };\n\n        var small = $(document).width() < 768;\n\n        /**\n         * Constructor for the Drawer.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var Drawer = function () {\n\n            if (!$(SELECTORS.TOGGLE_REGION).length) {\n                Log.debug('Page is missing a drawer region');\n            }\n            if (!$(SELECTORS.TOGGLE_ACTION).length) {\n                Log.debug('Page is missing a drawer toggle link');\n            }\n            $(SELECTORS.TOGGLE_REGION).each(function (index, ele) {\n                var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n                var drawerid = trigger.attr('aria-controls');\n                var drawer = $(document.getElementById(drawerid));\n                var hidden = trigger.attr('aria-expanded') == 'false';\n                var side = trigger.attr('data-side');\n                var body = $(SELECTORS.BODY);\n                var preference = trigger.attr('data-preference');\n                if (small) {\n                    M.util.set_user_preference(preference, 'false');\n                }\n\n                drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\n\n                if (!hidden) {\n                    body.addClass('drawer-open-' + side);\n                    trigger.attr('aria-expanded', 'true');\n                } else {\n                    trigger.attr('aria-expanded', 'false');\n                }\n            }.bind(this));\n\n            this.registerEventListeners();\n            if (small) {\n                this.closeAll();\n            }\n            $(SELECTORS.DRAWER + ' .nav-drawer-maximise').on('click',function(){\n                $(SELECTORS.TOGGLE_ACTION).trigger(\"click\");\n            });\n\n        };\n\n        Drawer.prototype.closeAll = function () {\n            $(SELECTORS.TOGGLE_REGION).each(function (index, ele) {\n                var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n                var side = trigger.attr('data-side');\n                var body = $(SELECTORS.BODY);\n                var drawerid = trigger.attr('aria-controls');\n                var drawer = $(document.getElementById(drawerid));\n                var preference = trigger.attr('data-preference');\n\n                trigger.attr('aria-expanded', 'false');\n                body.removeClass('drawer-open-' + side);\n                drawer.attr('aria-hidden', 'true');\n                drawer.addClass('closed');\n                if (!small) {\n                    M.util.set_user_preference(preference, 'false');\n                }\n            });\n        };\n\n        /**\n         * Open / close the blocks drawer.\n         *\n         * @method toggleDrawer\n         * @param {Event} e\n         */\n        Drawer.prototype.toggleDrawer = function (e) {\n            var trigger = $(e.target).closest('[data-action=toggle-drawer]');\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var body = $(SELECTORS.BODY);\n            var side = trigger.attr('data-side');\n            var preference = trigger.attr('data-preference');\n            if (small) {\n                M.util.set_user_preference(preference, 'false');\n            }\n\n            body.addClass('drawer-ease');\n\n            var open = trigger.attr('aria-expanded') == 'true';\n            var fullyexpanded = drawer.hasClass('fully-expanded');\n\n            if (!open) {\n                // Open.\n                trigger.attr('aria-expanded', 'true');\n                drawer.attr('aria-hidden', 'false');\n                drawer.focus();\n                body.addClass('drawer-open-' + side);\n                drawer.removeClass('closed');\n                if (!small) {\n                    M.util.set_user_preference(preference, 'true');\n                }\n            } else {\n                if (fullyexpanded) {\n                    // Close.\n                    drawer.removeClass('fully-expanded');\n                    body.removeClass('drawer-open-' + side);\n                    body.removeClass('drawer-fully-expanded');\n                    trigger.attr('aria-expanded', 'false');\n                    drawer.attr('aria-hidden', 'true');\n                    drawer.addClass('closed');\n                    if (!small) {\n                        M.util.set_user_preference(preference, 'false');\n                    }\n                } else {\n                    drawer.addClass('fully-expanded');\n                    body.addClass('drawer-fully-expanded');\n                }\n            }\n\n            // Publish an event to tell everything that the drawer has been toggled.\n            // The drawer transitions closed so another event will fire once teh transition\n            // has completed.\n            PubSub.publish('nav-drawer-toggle-start', open);\n        };\n\n        /**\n         * Prevent the page from scrolling when the drawer is at max scroll.\n         *\n         * @method preventPageScroll\n         * @param  {Event} e\n         */\n        Drawer.prototype.preventPageScroll = function (e) {\n            var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\n                bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\n                topOverflow = this.scrollTop <= 0;\n\n            if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\n                e.preventDefault();\n            }\n        };\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        Drawer.prototype.registerEventListeners = function () {\n\n            $(SELECTORS.TOGGLE_ACTION).each(function (index, element) {\n                CustomEvents.define($(element), [CustomEvents.events.activate]);\n                $(element).on(CustomEvents.events.activate, function (e, data) {\n                    this.toggleDrawer(data.originalEvent);\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            }.bind(this));\n\n            $(SELECTORS.SECTION).click(function () {\n                if (small) {\n                    this.closeAll();\n                }\n            }.bind(this));\n\n            // Publish an event to tell everything that the drawer completed the transition\n            // to either an open or closed state.\n            $(SELECTORS.DRAWER).on('webkitTransitionEnd msTransitionEnd transitionend', function (e) {\n                var drawer = $(e.target).closest(SELECTORS.DRAWER);\n                var open = drawer.attr('aria-hidden') == 'false';\n                PubSub.publish('nav-drawer-toggle-end', open);\n            });\n        };\n\n        return {\n            'init': function () {\n                return new Drawer();\n            }\n        };\n    });\n"],"file":"tsdrawer.min.js"}